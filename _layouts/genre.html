<!DOCTYPE html>
<html lang="en">
<head>
  {% include basic-head.html %}
</head>
<body>
  {% include header.html %}
  {% include nav-bar.html %}
  <div class="inner-nav">
        <div class="content">
            <div class="title"><span class="category">Genre:</span> {{ page.title }} <span class="category" id="searchLabel">Search:</span> <span id="searchIndicator"></span></div>
            <div class="controls">
              <div class="search">
                <input class="search-input" type="text" id="category-search" placeholder="Search this category">
                <div class="icon">
                  <?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="320px" height="320px" viewBox="0 0 320 320" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"> <title>search</title> <desc>Created with Sketch.</desc> <defs></defs> <g id="Page-5" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="search" sketch:type="MSArtboardGroup" fill="#000000"> <path d="M215.982742,193.664813 L204.079847,193.664813 L199.616844,189.201227 C214.495464,172.834746 223.422635,150.516817 223.422635,126.711026 C223.422052,73.1479962 180.274056,30 126.711026,30 C73.1479962,30 30,73.1479962 30,126.711026 C30,180.274056 73.1479962,223.422052 126.711026,223.422052 C150.516817,223.422052 172.834746,214.49488 189.201227,199.616261 L193.664813,204.079263 L193.664813,215.982159 L268.05791,290.375839 L290.375839,268.05791 L215.982742,193.664813 L215.982742,193.664813 Z M126.711026,193.664813 C89.5144775,193.664813 59.7572387,163.907574 59.7572387,126.711026 C59.7572387,89.5144775 89.5144775,59.7572387 126.711026,59.7572387 C163.907574,59.7572387 193.664813,89.5144775 193.664813,126.711026 C193.664813,163.907574 163.907574,193.664813 126.711026,193.664813 L126.711026,193.664813 Z" id="Shape" sketch:type="MSShapeGroup"></path> </g> </g></svg>
                </div>
              </div>
              <div class="sort-by">
                    <span>Sort by:</span>
                    <span id="sortBy"></span>
                    <ul class="menu" id="genres-menu">
                        <li onclick="updateSort('Recommended')">
                          Recommended
                        </li>
                        <li onclick="updateSort('Alphabetically')">
                          Alphabetically
                        </li>
                        <li onclick="updateSort('Year')">
                          Year
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
  <div class="main">
    <div class="content">
      <div class="thumbnails">
        {% for film in site.films %}
          {% if film.genre contains page.title %}
            {% include thumbnail.html %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <script type="text/javascript">
    function ascending(a, b) {
      return (a < b) ? -1 : (a > b) ? 1 : 0;
    }

    var $thumbnail = $('.thumbnail');
    var search = String(location.search);
    var m;

    if (m = search.match(/search=(\w+)/)) {
      var query = m[1].toLowerCase();
      $thumbnail.each(function() {
        var $this = $(this);
        var title = $this.find('.title a').text();
        if (title.toLowerCase().indexOf(query) === -1) {
          $this.hide();
        } else {
          $this.show();
        }
      });
    }

    if (m = search.match(/sort=(\w+)/)) {
      switch (m[1]) {
        case 'Alphabetically':
          $thumbnail.sortElements(function(a, b) {
            var $a = $(a).find('.title a');
            var $b = $(b).find('.title a');
            var contentA = $a.text();
            var contentB = $b.text();
            return ascending(contentA, contentB);
          });
          break;

        case 'Year':
          $thumbnail.sortElements(function(a, b) {
            var $a = $(a);
            var $b = $(b);
            var contentA = parseInt($a.attr('data-year'));
            var contentB = parseInt($b.attr('data-year'));
            return ascending(contentA, contentB);
          });
          break;
      }
    }

  </script>

  <script type="text/javascript">
    $("#category-search").pressEnter(function() {
      var url = replaceUrlParam(window.location.href, 'search', document.getElementById('category-search').value);
      window.open(url, "_self");
    });
  </script>

  <script type="text/javascript">
    function updateSort(sortValue) {
      var url = replaceUrlParam(window.location.href, 'sort', sortValue);
      window.open(url, "_self");
    }
  </script>

  <script type="text/javascript">
    //Indicating the search in the title:

    var searchTerm = getParameterByName('search');
    document.getElementById("searchIndicator").textContent = searchTerm;

    if (getParameterByName('search') == null) {
      document.getElementById("searchLabel").textContent = "";
    }

    //Indicating the sort in the sort dropdown:
    var sort = getParameterByName('sort');
    document.getElementById("sortBy").textContent = sort;

  </script>
</body>

<footer>
  {% include footer.html %}
</footer>
</html>

